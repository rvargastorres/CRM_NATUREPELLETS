<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM de Seguimiento B2B Naturpellet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, onSnapshot, query, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Establecer nivel de log para depuración de Firestore
        setLogLevel('Debug');

        let db, auth, userId;
        let clientsData = [];
        const STAGES = ["Prospección", "Estudio de Viabilidad", "Propuesta Enviada", "Cerrado (Ganado)", "Cerrado (Perdido)"];

        // --- Datos Iniciales de la Matriz de Prospección ---
        const initialClients = [
            // Prioridad 1
            { id: 'c1', name: 'Alberto López', company: 'Cooperativa Ganadera', role: 'Director de Producción', phone: '921165700', email: 'alopez@coopbrizo.es', address: 'Cuéllar, Segovia', segment: 'Gran Volumen', stage: 'Prospección', notes: 'Alto consumo gasóleo. Mencionar bajo mantenimiento de cenizas.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 150000, nextStep: 'Enviar panfleto y calculadora ROI.' },
            { id: 'c2', name: 'Elena Sanz', company: 'Bodega Premium', role: 'Resp. Infraestructuras', phone: '983881200', email: 'esanz@bodega-robles.es', address: 'Peñafiel, Valladolid', segment: 'Gran Volumen', stage: 'Prospección', notes: 'Interés en sostenibilidad certificada. Presupuesto alto.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 120000, nextStep: 'Llamada de apertura, enfocar en imagen de marca.' },
            { id: 'c3', name: 'Javier Morales', company: 'Industria de Procesado', role: 'Gerente de Compras', phone: '983204150', email: 'jmorales@indutermica.es', address: 'Valladolid', segment: 'Gran Volumen', stage: 'Prospección', notes: 'Alto volumen de secado, necesita ROI rápido.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 200000, nextStep: 'Preparar análisis de ahorro detallado.' },
            { id: 'c4', name: 'Ricardo Pérez', company: 'Invernaderos Comerciales', role: 'Propietario', phone: '920305020', email: 'rperez@hortusavila.es', address: 'Arévalo, Ávila', segment: 'Gran Volumen', stage: 'Prospección', notes: 'Crítico el suministro en invierno. Vender logística local.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 90000, nextStep: 'Definir precio fijo para el Q4.' },
            { id: 'c5', name: 'Marta Gil', company: 'Centro Logístico Frío', role: 'Directora de Operaciones', phone: '916738400', email: 'mgil@logi-centrale.es', address: 'Coslada, Madrid', segment: 'Gran Volumen', stage: 'Prospección', notes: 'Cumplimiento normativo de emisiones en Madrid.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 100000, nextStep: 'Investigar licencias ambientales.' },
            // Prioridad 2 (5 más)
            { id: 'c6', name: 'Daniel Cruz', company: 'ESE Regional', role: 'Jefe de Proyectos', phone: '917895500', email: 'dcruz@energy-soluciones.es', address: 'Madrid Capital', segment: 'Alianzas', stage: 'Prospección', notes: 'Busca socio estable para acuerdos marco.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 500000, nextStep: 'Presentar propuesta de Alianza B2B.' },
            { id: 'c7', name: 'Ana Ruiz', company: 'Distribuidor Local', role: 'Resp. Compras', phone: '947259330', email: 'aruiz@distribuidorcl.es', address: 'Burgos', segment: 'Alianzas', stage: 'Prospección', notes: 'Necesita ENplus A1 certificado y volumen de entrega semanal.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 80000, nextStep: 'Muestra de pellet a almacén.' },
            // Prioridad 3 (5 más)
            { id: 'c8', name: 'Laura Martín', company: 'Hotel Rural con SPA', role: 'Gerente', phone: '921170550', email: 'lmartin@hotelguadarrama.es', address: 'Villacastín, Segovia', segment: 'Alto Margen', stage: 'Prospección', notes: 'Alto margen. Confort del huésped y bajo mantenimiento.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 60000, nextStep: 'Citar caso de éxito de hotel balneario.' },
            { id: 'c9', name: 'Fernando Díaz', company: 'Complejo Deportivo', role: 'Director de Instalaciones', phone: '979778300', email: 'fdiaz@complejosports.es', address: 'Palencia', segment: 'Alto Margen', stage: 'Prospección', notes: 'Gran consumo en piscina climatizada. Foco en ahorro ROI.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 75000, nextStep: 'Usar calculadora ROI en reunión.' },
            { id: 'c10', name: 'Isabel Nieto', company: 'Balneario Histórico', role: 'Propietaria', phone: '983700850', email: 'inieto@balnearioviejo.es', address: 'Tierra de Pinares, Valladolid', segment: 'Alto Margen', stage: 'Prospección', notes: 'Necesita transición de combustible vieja. Vender limpieza.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 55000, nextStep: 'Ofrecer visita técnica gratuita.' },
            { id: 'c11', name: 'Carlos Ruiz', company: 'Residencia de Mayores', role: 'Director Financiero', phone: '916809010', email: 'cruiz@residenciamadrid.es', address: 'Leganés, Madrid', segment: 'Alto Margen', stage: 'Prospección', notes: 'Consumo constante 24/7. Argumento de estabilidad de precio.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 85000, nextStep: 'Solicitar datos de consumo de Gas Natural.' },
            { id: 'c12', name: 'Patricia Gómez', company: 'Restaurante de Bodas', role: 'Jefa de Climatización', phone: '947516440', email: 'pgomez@fincavinedos.es', address: 'Aranda de Duero, Burgos', segment: 'Alto Margen', stage: 'Prospección', notes: 'Vender imagen limpia y confort para clientes de eventos.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 45000, nextStep: 'Enviar panfleto con foco en caso Balneario.' },
            { id: 'c13', name: 'Pablo Jiménez', company: 'Instaladora de Calderas', role: 'Director Comercial', phone: '921411910', email: 'pjimenez@termosistem.es', address: 'Segovia', segment: 'Alianzas', stage: 'Prospección', notes: 'Interesado en evitar postventa por mala calidad de pellets.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 200000, nextStep: 'Reunión para definir condiciones de distribuidor.' },
            { id: 'c14', name: 'Sofía Vidal', company: 'Gran Almacén', role: 'Compradora', phone: '925500750', email: 'svidal@megaferreteria.es', address: 'Toledo', segment: 'Alianzas', stage: 'Prospección', notes: 'Busca marca premium para estantería B2C.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 150000, nextStep: 'Enviar lista de precios al por mayor.' },
            { id: 'c15', name: 'Ramón García', company: 'Operador Logístico', role: 'Director de Operaciones', phone: '918091000', email: 'rgarcia@granel-express.es', address: 'Getafe, Madrid', segment: 'Alianzas', stage: 'Prospección', notes: 'Vender la capacidad de producción para acopio.', lastContact: new Date().toISOString().substring(0, 10), nextFollowUp: '', value: 300000, nextStep: 'Visita a la planta de Sanchonuño.' },
        ];
        
        // --- Funciones de Firebase ---

        const APP = {
            init: async () => {
                // Inicialización de Firebase
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing. Data persistence will not work.");
                    // Si no hay config, se usa un modo de solo lectura/demo.
                    APP.renderClientList(initialClients);
                    return; 
                }

                try {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    // Autenticación (anónima o con token)
                    if (typeof __initial_auth_token !== 'undefined') {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                    
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            userId = user.uid;
                            APP.setupRealtimeListener(appId);
                        } else {
                            // Esto podría ocurrir si el token expira
                            console.error("User not authenticated.");
                        }
                    });

                } catch (e) {
                    console.error("Error initializing Firebase:", e);
                    APP.renderClientList(initialClients); // Carga datos de demo si hay error
                }
            },

            setupRealtimeListener: (appId) => {
                const clientsRef = collection(db, `artifacts/${appId}/users/${userId}/crm_naturpellet`);
                const q = query(clientsRef);

                // Escuchar cambios en tiempo real
                onSnapshot(q, (snapshot) => {
                    const loadedClients = [];
                    snapshot.forEach((doc) => {
                        loadedClients.push({ id: doc.id, ...doc.data() });
                    });
                    
                    if (loadedClients.length === 0) {
                        // Si no hay datos, cargar los iniciales y subirlos a Firestore
                        APP.seedInitialData(appId);
                    } else {
                        clientsData = loadedClients.sort((a, b) => {
                            const stageA = STAGES.indexOf(a.stage);
                            const stageB = STAGES.indexOf(b.stage);
                            return stageA - stageB;
                        });
                        APP.renderClientList(clientsData);
                    }
                }, (error) => {
                    console.error("Error al escuchar cambios en Firestore:", error);
                    APP.renderClientList(initialClients); // Carga datos de demo si falla el listener
                });
            },

            seedInitialData: async (appId) => {
                const clientsRef = collection(db, `artifacts/${appId}/users/${userId}/crm_naturpellet`);
                console.log("Cargando datos iniciales en Firestore...");
                for (const client of initialClients) {
                    const clientDocRef = doc(clientsRef, client.id);
                    // Usar setDoc para evitar duplicados si se llama varias veces
                    await setDoc(clientDocRef, client); 
                }
            },

            updateClient: async (clientId, updates) => {
                if (!db || !userId) {
                    console.error("Database not initialized or user not logged in.");
                    return;
                }
                const clientDocRef = doc(db, `artifacts/${__app_id}/users/${userId}/crm_naturpellet`, clientId);
                try {
                    await updateDoc(clientDocRef, updates);
                    console.log(`Cliente ${clientId} actualizado.`);
                } catch (e) {
                    console.error("Error al actualizar cliente:", e);
                }
            }
        };

        // --- Funciones de Renderizado y UI ---

        APP.renderClientList = (clients) => {
            const container = document.getElementById('client-list');
            container.innerHTML = ''; // Limpiar lista
            const segmentedClients = {};

            // Agrupar por Etapa (Stage)
            STAGES.forEach(stage => segmentedClients[stage] = []);
            clients.forEach(client => {
                if (segmentedClients[client.stage]) {
                    segmentedClients[client.stage].push(client);
                } else {
                    segmentedClients["Prospección"].push(client); // Fallback
                }
            });

            STAGES.forEach(stage => {
                const stageContainer = document.createElement('div');
                stageContainer.className = 'w-full md:w-1/4 lg:w-1/5 p-2 flex-shrink-0'; // Ajuste responsivo
                stageContainer.innerHTML = `
                    <div class="bg-gray-100 rounded-lg p-3 shadow-inner h-full flex flex-col">
                        <h3 class="text-sm font-bold uppercase mb-3 text-gray-700 border-b pb-1">${stage} (${segmentedClients[stage].length})</h3>
                        <div id="stage-${stage.replace(/\s/g, '-')}" class="space-y-3 flex-grow overflow-y-auto" style="min-height: 150px;">
                            ${APP.renderClientCards(segmentedClients[stage])}
                        </div>
                    </div>
                `;
                container.appendChild(stageContainer);
            });
        };

        APP.renderClientCards = (clients) => {
            return clients.map(client => `
                <div id="card-${client.id}" class="bg-white p-4 rounded-lg shadow-md cursor-pointer hover:shadow-lg transition duration-200 border-l-4 ${APP.getBorderColor(client.stage)}" onclick="showClientModal('${client.id}')">
                    <p class="text-xs font-semibold text-gray-500">${client.segment}</p>
                    <h4 class="text-md font-bold text-gray-800">${client.company}</h4>
                    <p class="text-sm text-gray-600">${client.name}</p>
                    <div class="mt-2 text-xs">
                        <p class="text-blue-600 font-medium">Próximo: ${client.nextFollowUp || 'N/A'}</p>
                        <p class="text-red-500 font-medium">${client.value ? 'Valor: ' + APP.formatCurrency(client.value) : ''}</p>
                    </div>
                </div>
            `).join('');
        };

        APP.getBorderColor = (stage) => {
            switch (stage) {
                case 'Prospección': return 'border-yellow-500';
                case 'Estudio de Viabilidad': return 'border-blue-500';
                case 'Propuesta Enviada': return 'border-purple-500';
                case 'Cerrado (Ganado)': return 'border-green-500';
                case 'Cerrado (Perdido)': return 'border-red-500';
                default: return 'border-gray-300';
            }
        };

        APP.formatCurrency = (value) => {
            return new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(value);
        };

        // --- Funciones de Modal y Edición ---

        window.showClientModal = (clientId) => {
            const client = clientsData.find(c => c.id === clientId);
            if (!client) return;

            const modal = document.getElementById('client-modal');
            const form = document.getElementById('client-form');
            form.dataset.clientId = clientId;

            // Rellenar campos del formulario
            document.getElementById('edit-name').value = client.name || '';
            document.getElementById('edit-company').value = client.company || '';
            document.getElementById('edit-role').value = client.role || '';
            document.getElementById('edit-phone').value = client.phone || '';
            document.getElementById('edit-email').value = client.email || '';
            document.getElementById('edit-address').value = client.address || '';
            document.getElementById('edit-segment').value = client.segment || '';
            document.getElementById('edit-value').value = client.value || '';
            document.getElementById('edit-notes').value = client.notes || '';
            document.getElementById('edit-nextStep').value = client.nextStep || '';
            document.getElementById('edit-lastContact').value = client.lastContact || new Date().toISOString().substring(0, 10);

            // Rellenar etapa de venta
            const stageSelect = document.getElementById('edit-stage');
            stageSelect.innerHTML = STAGES.map(stage => 
                `<option value="${stage}" ${client.stage === stage ? 'selected' : ''}>${stage}</option>`
            ).join('');

            // Rellenar próxima fecha de seguimiento
            document.getElementById('edit-nextFollowUp').value = client.nextFollowUp || '';

            // Generar sugerencias de recordatorio
            document.getElementById('reminder-output').innerHTML = APP.generateReminder(client);
            
            modal.classList.remove('hidden');
        };

        window.closeClientModal = () => {
            document.getElementById('client-modal').classList.add('hidden');
        };

        window.saveClientChanges = async () => {
            const form = document.getElementById('client-form');
            const clientId = form.dataset.clientId;

            const updates = {
                name: document.getElementById('edit-name').value,
                company: document.getElementById('edit-company').value,
                role: document.getElementById('edit-role').value,
                phone: document.getElementById('edit-phone').value,
                email: document.getElementById('edit-email').value,
                address: document.getElementById('edit-address').value,
                segment: document.getElementById('edit-segment').value,
                stage: document.getElementById('edit-stage').value,
                value: parseFloat(document.getElementById('edit-value').value) || 0,
                notes: document.getElementById('edit-notes').value,
                nextStep: document.getElementById('edit-nextStep').value,
                lastContact: document.getElementById('edit-lastContact').value,
                nextFollowUp: document.getElementById('edit-nextFollowUp').value,
            };

            await APP.updateClient(clientId, updates);
            closeClientModal();
        };

        // --- Funciones de Recordatorios Personalizados ---
        APP.generateReminder = (client) => {
            let message = '';
            let subject = '';

            const today = new Date();
            const followUpDate = client.nextFollowUp ? new Date(client.nextFollowUp) : null;
            const daysUntilFollowUp = followUpDate ? Math.ceil((followUpDate - today) / (1000 * 60 * 60 * 24)) : null;

            let tone = 'neutral';
            if (daysUntilFollowUp !== null && daysUntilFollowUp <= 0) {
                tone = 'urgente';
            } else if (client.stage === 'Cerrado (Ganado)') {
                tone = 'postventa';
            }

            // Mensajes base
            if (tone === 'urgente') {
                subject = `Seguimiento Urgente: Propuesta Naturpellet para ${client.company}`;
                message = `Estimado/a ${client.name},\n\nLe escribo para retomar la conversación sobre el '${client.nextStep}'. Han pasado algunos días desde nuestra última interacción y queremos asegurarnos de que toda su información esté clara antes de proceder con el estudio. ¿Podríamos hablar 5 minutos hoy? Por favor y gracias.`;
            } else if (tone === 'postventa') {
                subject = `Post-Venta: Revisión de Suministro en ${client.company}`;
                message = `Estimado/a ${client.name},\n\nEsperamos que el suministro de Naturpellet esté funcionando a plena satisfacción. Queríamos hacer un chequeo de cortesía para confirmar que la logística y la calidad del pellet cumplen sus expectativas, especialmente ahora que la demanda de ${client.segment} es alta. Si tiene algún comentario, estamos a su disposición. Por favor y gracias.`;
            } else if (client.stage === 'Estudio de Viabilidad') {
                subject = `Avance: Estudio de Viabilidad Energética para ${client.company}`;
                message = `Estimado/a ${client.name},\n\nHemos avanzado en el análisis de ahorro. El potencial de ROI estimado con nuestro pellet certificado es muy prometedor. Me gustaría presentarle los datos clave en una breve videollamada mañana. ¿Le viene bien a las 10:00 o a las 16:00? Por favor y gracias.`;
            } else { // Prospección o Propuesta Enviada
                subject = `Propuesta Comercial Naturpellet - ${client.segment}`;
                message = `Estimado/a ${client.name},\n\nComo parte de nuestro seguimiento, le recuerdo el valor de nuestra propuesta: '${client.nextStep}'. Naturpellet garantiza un suministro local y estable. Quedo atento a sus comentarios o preguntas sobre la viabilidad económica. Por favor y gracias.`;
            }

            return `
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h5 class="font-bold text-blue-800 mb-2">Asunto: ${subject}</h5>
                    <div class="whitespace-pre-wrap text-sm text-gray-700">${message}</div>
                    <p class="mt-3 text-xs text-red-500 font-semibold">Mensaje incluye cortesía: "Por favor y gracias".</p>
                </div>
            `;
        };

        // Inicializar la aplicación
        window.addEventListener('load', APP.init);

    </script>
    
    <!-- Estilos Tailwind ajustados al branding de Naturpellet (Verde Oliva y Marrón) -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .color-primary-bg { background-color: #4d592e; } /* Verde Oliva Oscuro */
        .color-primary-text { color: #4d592e; }
        .color-accent-text { color: #ff6a00; } /* Naranja/Ardilla */
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .stage-container {
            height: calc(100vh - 120px); /* Altura ajustable para el scroll */
        }
    </style>
</head>
<body class="p-4">

    <header class="mb-6 pb-4 border-b border-gray-300 flex justify-between items-center">
        <h1 class="text-3xl font-extrabold color-primary-text flex items-center">
             <span class="color-accent-text mr-2 text-4xl font-black">Naturpellet</span> CRM B2B 
        </h1>
        <p class="text-sm text-gray-500">Ejecutor: <span id="user-id-display">Cargando...</span> | Total de Clientes: ${initialClients.length}</p>
    </header>

    <!-- Kanban Board para el Seguimiento -->
    <div id="client-list" class="flex flex-row overflow-x-auto space-x-4 stage-container">
        <!-- El contenido se renderiza aquí por JS (APP.renderClientList) -->
        <div class="w-full text-center p-10 text-gray-500">Cargando datos de clientes...</div>
    </div>

    <!-- Modal de Edición del Cliente -->
    <div id="client-modal" class="modal fixed inset-0 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-screen overflow-y-auto">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-2xl font-bold color-primary-text">Ficha de Seguimiento y Edición</h2>
                <button onclick="closeClientModal()" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            
            <form id="client-form" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Columna 1: Datos de Contacto y Etapa -->
                <div class="space-y-4 border-r md:pr-4">
                    <h3 class="text-lg font-bold color-primary-text mb-2">1. Datos del Cliente</h3>
                    <div><label class="block text-sm font-medium">Empresa</label><input type="text" id="edit-company" class="mt-1 w-full p-2 border rounded-lg"></div>
                    <div><label class="block text-sm font-medium">Contacto</label><input type="text" id="edit-name" class="mt-1 w-full p-2 border rounded-lg"></div>
                    <div><label class="block text-sm font-medium">Cargo</label><input type="text" id="edit-role" class="mt-1 w-full p-2 border rounded-lg"></div>
                    <div><label class="block text-sm font-medium">Teléfono</label><input type="text" id="edit-phone" class="mt-1 w-full p-2 border rounded-lg"></div>
                    <div><label class="block text-sm font-medium">Email</label><input type="email" id="edit-email" class="mt-1 w-full p-2 border rounded-lg"></div>
                    <div><label class="block text-sm font-medium">Dirección/Ubicación</label><input type="text" id="edit-address" class="mt-1 w-full p-2 border rounded-lg"></div>
                    
                    <h3 class="text-lg font-bold color-primary-text mt-6 mb-2">2. Etapa de Venta</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium">Segmento</label><input type="text" id="edit-segment" class="mt-1 w-full p-2 border rounded-lg" readonly></div>
                        <div><label class="block text-sm font-medium">Valor Estimado (€)</label><input type="number" id="edit-value" class="mt-1 w-full p-2 border rounded-lg"></div>
                    </div>
                    <div><label class="block text-sm font-medium">Etapa Actual</label>
                        <select id="edit-stage" class="mt-1 w-full p-2 border rounded-lg"></select>
                    </div>
                </div>

                <!-- Columna 2: Seguimiento y Recordatorios -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold color-primary-text mb-2">3. Historial y Planificación</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium">Último Contacto</label><input type="date" id="edit-lastContact" class="mt-1 w-full p-2 border rounded-lg"></div>
                        <div><label class="block text-sm font-medium font-bold text-blue-600">Próximo Seguimiento</label><input type="date" id="edit-nextFollowUp" class="mt-1 w-full p-2 border rounded-lg border-blue-500"></div>
                    </div>
                    <div><label class="block text-sm font-medium">Próximo Paso</label><input type="text" id="edit-nextStep" class="mt-1 w-full p-2 border rounded-lg"></div>
                    <div><label class="block text-sm font-medium">Notas de Seguimiento (Log)</label><textarea id="edit-notes" rows="4" class="mt-1 w-full p-2 border rounded-lg"></textarea></div>

                    <h3 class="text-lg font-bold color-primary-text mt-6 mb-2">4. Recordatorio Personalizado</h3>
                    <div id="reminder-output" class="mb-4">
                        <!-- Aquí se genera el mensaje de recordatorio -->
                    </div>

                    <div class="pt-4 border-t">
                        <button type="button" onclick="saveClientChanges()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition duration-200">
                            GUARDAR CAMBIOS
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

</body>
</html>
